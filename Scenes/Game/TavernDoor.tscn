[gd_scene load_steps=39 format=3 uid="uid://mkl1ivf2pshi"]

[ext_resource type="Script" path="res://scripts/Game/TavernDoor.gd" id="1_7qtlc"]
[ext_resource type="Texture2D" uid="uid://dkv6q0qyhqf0" path="res://art/sprites/tavern_door_animation.png" id="1_rwli4"]
[ext_resource type="Texture2D" uid="uid://2r5bnfjqkfsg" path="res://art/sprites/tilesets/tavern_door.png" id="2_6p4q5"]
[ext_resource type="Texture2D" uid="uid://xt1qoygyhq38" path="res://art/sprites/tilesets/tavern_door_normal.png" id="4_k5ftt"]
[ext_resource type="PackedScene" uid="uid://phmysi5nhblq" path="res://Scenes/helper/Actionable.tscn" id="4_oox3w"]

[sub_resource type="AtlasTexture" id="AtlasTexture_mipmo"]
atlas = ExtResource("1_rwli4")
region = Rect2(192, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_75k6u"]
atlas = ExtResource("1_rwli4")
region = Rect2(128, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_d2vni"]
atlas = ExtResource("1_rwli4")
region = Rect2(64, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_1eh6k"]
atlas = ExtResource("1_rwli4")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_y3anj"]
atlas = ExtResource("1_rwli4")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_lnaxw"]
atlas = ExtResource("1_rwli4")
region = Rect2(64, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_2q6xv"]
atlas = ExtResource("1_rwli4")
region = Rect2(128, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ueaku"]
atlas = ExtResource("1_rwli4")
region = Rect2(192, 0, 64, 64)

[sub_resource type="SpriteFrames" id="SpriteFrames_5qx3e"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_mipmo")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_75k6u")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_d2vni")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_1eh6k")
}],
"loop": false,
"name": &"close",
"speed": 8.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_y3anj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lnaxw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2q6xv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ueaku")
}],
"loop": false,
"name": &"open",
"speed": 8.0
}]

[sub_resource type="CanvasTexture" id="CanvasTexture_4ua5r"]
diffuse_texture = ExtResource("2_6p4q5")
normal_texture = ExtResource("4_k5ftt")

[sub_resource type="TileSetAtlasSource" id="TileSetAtlasSource_an2r7"]
texture = SubResource("CanvasTexture_4ua5r")
0:0/0 = 0
0:0/0/y_sort_origin = 24
0:1/0 = 0
0:1/0/y_sort_origin = 16
0:2/0 = 0
1:0/0 = 0
1:0/0/y_sort_origin = 24
2:0/0 = 0
2:0/0/y_sort_origin = 24
3:0/0 = 0
3:0/0/y_sort_origin = 24
3:1/0 = 0
3:1/0/y_sort_origin = 16
3:2/0 = 0

[sub_resource type="TileSet" id="TileSet_vl1lw"]
sources/0 = SubResource("TileSetAtlasSource_an2r7")

[sub_resource type="Animation" id="Animation_17v80"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Door:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"open"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Door:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Door_L_Angle:rotation")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("Door_R_Angle:rotation")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}

[sub_resource type="Animation" id="Animation_jcwud"]
resource_name = "close"
length = 0.8
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Door:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"close"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Door:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Door_L_Angle:rotation")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [1.39626, 1.0472, 0.436332, 3.48787e-16]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("Door_R_Angle:rotation")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [-1.39626, -1.0472, -0.436332, 3.48787e-16]
}

[sub_resource type="Animation" id="Animation_s1qq2"]
resource_name = "closed"
length = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Door:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"close"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Door:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [3]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Door_L_Angle:rotation")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [3.48787e-16]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("Door_R_Angle:rotation")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [3.48787e-16]
}

[sub_resource type="Animation" id="Animation_b8ido"]
resource_name = "open"
length = 0.8
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Door:animation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"open"]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Door:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Door_L_Angle:rotation")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [3.48787e-16, 0.436332, 1.0472, 1.39626]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("Door_R_Angle:rotation")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0, 0.2, 0.4, 0.6),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [3.48787e-16, -0.436332, -1.0472, -1.39626]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_lts5n"]
_data = {
"RESET": SubResource("Animation_17v80"),
"close": SubResource("Animation_jcwud"),
"closed": SubResource("Animation_s1qq2"),
"open": SubResource("Animation_b8ido")
}

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_wdyvd"]
animation = &"close"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ti1ke"]
animation = &"closed"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ggfdx"]
animation = &"open"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_t540a"]
switch_mode = 2
advance_mode = 2
advance_expression = "!is_open"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_2ch0p"]
switch_mode = 2
advance_mode = 2
advance_expression = "is_open"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_nki4t"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_t5lvd"]
advance_mode = 2
advance_expression = "is_open"

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_au3kx"]
states/close/node = SubResource("AnimationNodeAnimation_wdyvd")
states/close/position = Vector2(573, 73.5)
states/closed/node = SubResource("AnimationNodeAnimation_ti1ke")
states/closed/position = Vector2(338.64, 30.225)
states/open/node = SubResource("AnimationNodeAnimation_ggfdx")
states/open/position = Vector2(392, 248)
transitions = ["open", "close", SubResource("AnimationNodeStateMachineTransition_t540a"), "close", "open", SubResource("AnimationNodeStateMachineTransition_2ch0p"), "Start", "closed", SubResource("AnimationNodeStateMachineTransition_nki4t"), "closed", "open", SubResource("AnimationNodeStateMachineTransition_t5lvd")]
graph_offset = Vector2(117.86, -74.315)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_2qtpi"]
size = Vector2(38.25, 20)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_a24w4"]
size = Vector2(16, 10)

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_7kbh7"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_irh08"]
size = Vector2(16, 2)

[sub_resource type="OccluderPolygon2D" id="OccluderPolygon2D_a8gsu"]
polygon = PackedVector2Array(0, 0, 16, 0, 16, -2, 0, -2)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_w6g6g"]
size = Vector2(16, 2)

[sub_resource type="OccluderPolygon2D" id="OccluderPolygon2D_e6dvx"]
polygon = PackedVector2Array(0, 0, -16, 0, -16, -2, 0, -2)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_vxnhj"]
size = Vector2(52, 72)

[node name="TavernDoor" type="Node2D"]
y_sort_enabled = true
script = ExtResource("1_7qtlc")

[node name="Door" type="AnimatedSprite2D" parent="."]
light_mask = 4
y_sort_enabled = true
position = Vector2(0, 1.76)
sprite_frames = SubResource("SpriteFrames_5qx3e")
animation = &"open"
offset = Vector2(2.08165e-12, -13.76)

[node name="Wall" type="TileMap" parent="."]
visible = false
light_mask = 4
y_sort_enabled = true
position = Vector2(2.08165e-12, 2.08165e-12)
tile_set = SubResource("TileSet_vl1lw")
format = 2
layer_0/y_sort_enabled = true
layer_0/tile_data = PackedInt32Array(-65538, 0, 0, -65537, 65536, 0, -131072, 131072, 0, -131071, 196608, 0, -65535, 196608, 1, 1, 196608, 2, -2, 0, 1, 65534, 0, 2)

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_lts5n")
}

[node name="AnimationTree" type="AnimationTree" parent="."]
libraries = {
"": SubResource("AnimationLibrary_lts5n")
}
tree_root = SubResource("AnimationNodeStateMachine_au3kx")
advance_expression_base_node = NodePath("..")
anim_player = NodePath("../AnimationPlayer")

[node name="Actionable" parent="." instance=ExtResource("4_oox3w")]
position = Vector2(0, -12)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Actionable"]
position = Vector2(0, 12)
shape = SubResource("RectangleShape2D_2qtpi")

[node name="Wall_L" type="StaticBody2D" parent="."]
position = Vector2(0, -12)
collision_mask = 3

[node name="CollisionShape2D" type="CollisionShape2D" parent="Wall_L"]
light_mask = 0
position = Vector2(-24, 11)
shape = SubResource("RectangleShape2D_a24w4")

[node name="Wall_R" type="StaticBody2D" parent="."]
position = Vector2(0, -12)
collision_mask = 3

[node name="CollisionShape2D" type="CollisionShape2D" parent="Wall_R"]
light_mask = 0
position = Vector2(24, 11)
shape = SubResource("RectangleShape2D_a24w4")

[node name="Door_L_Angle" type="Marker2D" parent="."]
position = Vector2(-16, 2)

[node name="Door_L" type="RigidBody2D" parent="Door_L_Angle"]
position = Vector2(16, -14)
collision_mask = 2
physics_material_override = SubResource("PhysicsMaterial_7kbh7")
freeze = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="Door_L_Angle/Door_L"]
position = Vector2(-8, 13)
shape = SubResource("RectangleShape2D_irh08")

[node name="LightOccluder2D" type="LightOccluder2D" parent="Door_L_Angle"]
occluder = SubResource("OccluderPolygon2D_a8gsu")

[node name="Door_R_Angle" type="Marker2D" parent="."]
position = Vector2(16, 2)

[node name="Door_R" type="RigidBody2D" parent="Door_R_Angle"]
position = Vector2(-16, -14)
collision_mask = 2
physics_material_override = SubResource("PhysicsMaterial_7kbh7")
freeze = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="Door_R_Angle/Door_R"]
position = Vector2(8, 13)
shape = SubResource("RectangleShape2D_w6g6g")

[node name="LightOccluder2D" type="LightOccluder2D" parent="Door_R_Angle"]
occluder = SubResource("OccluderPolygon2D_e6dvx")

[node name="Area2D" type="Area2D" parent="."]
position = Vector2(0, -12)
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D"]
position = Vector2(0, 14)
shape = SubResource("RectangleShape2D_vxnhj")

[connection signal="body_entered" from="Area2D" to="." method="_on_area_2d_body_entered"]
[connection signal="body_exited" from="Area2D" to="." method="_on_area_2d_body_exited"]
